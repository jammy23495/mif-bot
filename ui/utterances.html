<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" type="image/x-icon" href="./assets/favico.png">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="./assets/vendor.min.css">

    <!-- jQuery library -->
    <script src="./assets/js/jquery.min.js"></script>

    <!-- Data Tables -->
    <script src="./assets/js/datatables.min.js"></script>

    <!-- Data Tables Buttons -->
    <script src="./assets/js/datatablebuttons.min.js"></script>


    <!-- Latest compiled JavaScript -->
    <script src="./assets/js/bootstrap.min.js"></script>
    <script src="./assets/js/angularjs.min.js"></script>
    <script src="./assets/js/swal.min.js"></script>


    <title>MIF Bot - Utterances</title>
</head>

<body ng-cloak ng-app="myUtteranceApp" ng-controller="UtteranceController">

    <div class="mt-3" style="padding: 20px;">
        <h2 style="text-align: center;">Utterances</h2>
        <div class="row" style="margin-bottom: 20px;">
            <div class="mb-3 mt-3 col-md-3">
                <label for="utterance">Utterance</label>
                <input type="text" class="form-control" id="utterance" ng-model="utterance"
                    placeholder="Enter Utterance" name="utterance">
            </div>
            <div class="mb-3 mt-3 col-md-3">
                <label for="intent">Intent</label>
                <select class="form-control" ng-model="intent">
                    <option ng-repeat="i in Intents">{{i.Intent}}</option>
                </select>
            </div>
            <div class="mb-3 mt-3 col-md-3">
                <label for="intent">Language</label>
                <select class="form-control" ng-model="language">
                    <option>en</option>
                </select>
            </div>
            <div class="mb-3 mt-3 col-md-3">
                <button type="submit" class="btn btn-primary" style="margin-top: 32px;"
                    ng-click="addUtterance()">Submit</button>
            </div>
        </div>

        <!-- Table -->

        <div class="row">
            <div class="col">
                <table id="Utterance" class="table table-striped" style="width:100%">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Utterance</th>
                            <th>Intent</th>
                            <th>Language</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="Utterance in Utterances">
                            <td>{{Utterance.ID}}</td>
                            <td>{{Utterance.Utterance}}</td>
                            <td>{{Utterance.Intent}}</td>
                            <td>{{Utterance.Language}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

</body>

</html>


<script>
    let HOST = window.location.origin;

    var app = angular.module("myUtteranceApp", [])
    app.controller("UtteranceController", async function ($scope, $http) {
        var table = null
        async function getUtterance() {
            const element = document.getElementById("Utterance")
            if (element) {
                $('#Utterance').DataTable().clear().destroy();
            }
            let response = await $http.get(`${HOST}/utterances/get`)
            if (response.data.length > 0) {
                $scope.$apply(() => {
                    $scope.Utterances = response.data
                });
            } else {
                $scope.Utterances = []
            }
            table = $('#Utterance').DataTable({
                dom: "<'row'<'col-sm-12 col-md-6'B><'col-sm-12 col-md-6'f>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row'<'col-sm-12 col-md-4'i><'col-sm-12 col-md-4'l><'col-sm-12 col-md-4'p>>",
                lengthMenu: [
                    [5, 10, 25, 50, -1],
                    [5, 10, 25, 50, 'All'],
                ],
                order: [0, 'desc'],
            });
        }

        async function getIntents() {
            let response = await $http.get(`${HOST}/intents/get`)
            if (response.data.length > 0) {
                $scope.$apply(() => {
                    $scope.Intents = response.data
                });
            } else {
                $scope.Intents = []
            }
        }

        $scope.addUtterance = async function () {
            let data = {
                "utterance": $scope.utterance,
                "language": $scope.language,
                "intent": $scope.intent
            }
            console.log("Utterance: ", $scope.utterance)
            console.log("Intent: ", $scope.intent)
            console.log("Language: ", $scope.language)

            $http.post(`${HOST}/utterances/add`, JSON.stringify(data))
                .then(async function successCallback(response) {
                        if (response && response.data && response.data.status == 200) {
                            await getUtterance()
                            $('#utterance').val("")
                            Swal.fire(
                                'Good job!',
                                'You added a new Utterance',
                                'success'
                            )
                        }
                    },
                    function errorCallback(response) {
                        console.log(response)
                        Swal.fire(
                            'Insertion Failed!',
                            'Error in adding Utterance',
                            'error'
                        )
                    });


        }

        await getUtterance()
        await getIntents()
    })
</script>